<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Disparo WhatsApp - EXCLUSIVE PASS</title>
  <style>
    body{font-family:'Segoe UI',sans-serif;background:#0f0c29;color:#eee;margin:0;padding:20px;text-align:center;min-height:100vh}
    .box{max-width:600px;margin:30px auto;background:#16213e;padding:30px;border-radius:20px;box-shadow:0 0 40px #000}
    h1{color:#25d366;font-size:32px;margin:0 0 20px}
    .info{background:#1a1a5e;padding:20px;border-radius:15px;margin:20px 0;font-size:18px;line-height:1.5}
    button{padding:16px 40px;font-size:20px;background:#25d366;color:#000;border:none;border-radius:15px;margin:20px;cursor:pointer;font-weight:bold;transition:background 0.3s}
    button:hover{background:#128c7e}
    button:disabled{background:#666;cursor:not-allowed}
    #progress{display:none;background:#1a1a5e;padding:15px;border-radius:10px;margin:20px 0}
    #progress p{margin:5px 0;color:#ffd700}
  </style>
</head>
<body>
  <div class="box">
    <h1>EXCLUSIVE PASS</h1>
    <h2 style="color:#fff;margin:10px 0">Disparo Autom√°tico WhatsApp</h2>
    <div class="info">
      <p><strong>Como funciona:</strong></p>
      <p>1. Cole os links + senhas na √°rea de texto abaixo (ou gere os convites primeiro pra copiar autom√°tico).</p>
      <p>2. Clique em "INICIAR DISPARO" ‚Üí abre uma conversa por vez com mensagem pronta.</p>
      <p>3. √â s√≥ dar ENTER pra enviar! (Delay de 3s entre cada pra evitar bloqueio)</p>
    </div>
    <textarea id="links" rows="8" style="width:100%;background:#1a1a5e;color:#fff;border:none;border-radius:10px;padding:15px;font-size:16px;box-sizing:border-box" placeholder="Cole aqui os links gerados (ex: Calil ‚Üí https://... (senha: ...))"></textarea>
    <br>
    <button onclick="iniciarDisparo()" id="btn">INICIAR DISPARO</button>
    <div id="progress"></div>
  </div>

  <script>
    let listaGlobal = []; // Recebe a lista do index.html

    // Recebe dados da janela pai
    window.addEventListener("message", e => {
      if (e.data.lista) listaGlobal = e.data.lista;
      if (e.data.links) {
        document.getElementById("links").value = e.data.links;
      }
    });

    // Fun√ß√£o pra colar autom√°tico da clipboard (se dispon√≠vel)
    async function colarAutomatico() {
      try {
        const texto = await navigator.clipboard.readText();
        if (texto.includes("https://calvinfmei-prog.github.io")) {
          document.getElementById("links").value = texto;
        }
      } catch {}
    }
    colarAutomatico(); // Cola na carga da p√°gina

    async function iniciarDisparo() {
      const texto = document.getElementById("links").value.trim();
      if (!texto) return alert("Cole os links + senhas primeiro!");

      const linhas = texto.split('\n').filter(l => l.includes('http'));
      if (linhas.length === 0) return alert("Nenhum link v√°lido encontrado!");

      if (!confirm(`Vou abrir ${linhas.length} conversas no WhatsApp.\n\nCada uma com mensagem pronta ‚Äî s√≥ dar ENTER!\n\nContinuar?`)) return;

      const btn = document.getElementById("btn");
      const progress = document.getElementById("progress");
      btn.disabled = true;
      btn.textContent = "DISPARANDO...";
      progress.style.display = "block";

      let enviados = 0;
      for (let i = 0; i < linhas.length; i++) {
        const linha = linhas[i];
        const nome = linha.split(" ‚Üí ")[0].trim();
        const linkCompleto = linha.split(" ‚Üí ")[1].split(" (")[0];

        // Busca telefone na lista global
        const pessoa = listaGlobal.find(p => p.nome.toLowerCase().includes(nome.toLowerCase()));
        let url = "";

        if (pessoa && pessoa.telefone) {
          const tel = pessoa.telefone.replace(/\D/g, '');
          const msg = encodeURIComponent(
            `Ol√° *${nome.split(" ")[0]}*! üéâ\n\nVoc√™ est√° convidado para a *FESTA EXCLUSIVA*!\n\nSeu convite individual:\n${linkCompleto}\n\nAcesse o link e use a senha pra baixar seu PNG com QR Code.\n\nTe vejo l√°! üî•`
          );
          url = `https://wa.me/55${tel}?text=${msg}`;
        } else {
          // Fallback: abre WhatsApp Web com texto pronto (pra voc√™ colar manual)
          const msg = encodeURIComponent(
            `Ol√° *${nome.split(" ")[0]}*! Seu convite:\n${linkCompleto}`
          );
          url = `https://web.whatsapp.com/send?text=${msg}`;
        }

        // Abre a conversa
        window.open(url, '_blank');

        // Atualiza progresso
        enviados++;
        progress.innerHTML = `
          <p><strong>Progresso:</strong> ${enviados}/${linhas.length}</p>
          <p>Enviando para: <strong>${nome}</strong></p>
          <p><small>Aba aberta! D√™ ENTER pra enviar e espere 3s pro pr√≥ximo...</small></p>
        `;

        // Delay de 3 segundos (seguro pro WhatsApp)
        if (i < linhas.length - 1) {
          await new Promise(r => setTimeout(r, 3000));
        }
      }

      // Finaliza
      btn.disabled = false;
      btn.textContent = "DISPARO CONCLU√çDO!";
      progress.innerHTML += "<p style='color:#25d366'><strong>SUCESSO! Todas as abas abertas.</strong></p>";
      setTimeout(() => {
        progress.style.display = "none";
        btn.textContent = "INICIAR NOVO DISPARO";
      }, 5000);
    }
  </script>
</body>
</html>
